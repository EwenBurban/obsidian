<h2 id="setup">setup</h2>
<pre><code>mkdir Da_synonymous
cd Da_synonymous</code></pre>
<h2 id="install-vep">install vep</h2>
<p>local</p>
<pre><code>sudo singularity build vep.sif docker://ensemblorg/ensembl-vep:latest</code></pre>
<p>on server</p>
<pre><code>singularity build --remote vep.sif docker://ensemblorg/ensembl-vep:latest</code></pre>
<h2 id="set-up-cache-for-your-system-if-possible">set up cache for your system (if possible)</h2>
<p>go to : http://ftp.ebi.ac.uk/ensemblgenomes/pub/plants/current/variation/vep/ and find your species <code>species_file={name of your species file in the link}</code></p>
<pre><code>mkdir vep_cache
cd vep_cache
curl -O http://ftp.ebi.ac.uk/ensemblgenomes/pub/plants/current/variation/vep/${species_file}
tar xvf ${species_file}</code></pre>
<h2 id="setup2">setup2</h2>
<pre><code>vcf={path to your vcf file}
species={species name}
version={number of your cache version}
container={path to the container python.sif in RIDGE/container/}
binpath={path were vcf2abc is store : RIDGE/faker_module/}

popfile={path to popfile}
contig_data={path to contig data}
nameA={name of popA}
naneB={name of popB}
window_size=100000</code></pre>
<p><strong>NB</strong> : the version of your cache is written on the file name that you got here : http://ftp.ebi.ac.uk/ensemblgenomes/pub/plants/current/variation/vep/ ## get synonymous position</p>
<h3 id="run-vep">run vep</h3>
<pre><code>singularity exec vep.sif -i ${vcf} -o ${species}_vep.txt --cache --dir_cache vep_cache/ --cache_version ${version} --offline --species ${species}</code></pre>
<h3 id="get-the-synonymous-position-and-calculate-da">get the synonymous position and calculate Da</h3>
<pre class="{sh}"><code>grep &#39;synonymous&#39; ${species}_vep.txt &gt; ${species}_synonymous_vep.txt
cut -f2 ${species}_synonymous_vep.txt &gt; ${species}_synonymous_positions.txt
sed -i &#39;s/:/\t/g&#39; ${species}_synonymous_positions.txt
bcftools view -R ${species}_synonymous_positions.txt -o ${species}_synonymous.vcf
singularity exec ${container} ${binpath}/vcf2abc.py data=${species}_synonymous.vcf\ 
    contig_file=${contig_data} popfile=${popfile} nameA=${nameA} nameB=${nameB}\ 
    output_dir=. window_size=${window_size}
</code></pre>
<p>Da is contained in ABCstat_global.txt in the column netdivAB_avg</p>
